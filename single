from fillpdf import fillpdfs

# Path to your blank W-8BEN-E form PDF
form_pdf_path = r"C:/Users/user/Downloads/fw8bene.pdf"  

# Step 1: Extract all field names from the PDF form (run once to know all PDF field keys)
fields = fillpdfs.get_form_fields(form_pdf_path)
print("PDF Form Fields and current values:")
for k, v in fields.items():
    print(f"{k}: {v}")

# Step 2: Prepare mapping of your JSON data fields to the exact PDF form fields (update after inspecting output above)
data_dict = {
    'f1_01(0)': "Aurelxia Pharma GmbH",                       # Name of organization (Check exact field name after extraction)
    'f1_02(0)': "Germany",                                   # Country of incorporation or organization
    'f1_06(0)': "Konrad-Adenauer-Strasse 22, 50668 KÃ¶ln, Germany",  # Permanent residence address
    'f1_08(0)': "",                                          # US TIN (empty in the example)
    'f1_09(0)': "DE316953228",                               # Foreign TIN
    'f1_33(0)': "Ilona Behringer",                           # Signature (printed name)
    'f1_34(0)': "06-12-2024",                               # Date signed, format MM-DD-YYYY
    # Add any other fields as seen in the extraction
}

# Step 3: Fill the PDF form with the mapped data and save output
output_filled_pdf = "W8BEN-E_filled.pdf"
fillpdfs.write_fillable_pdf(form_pdf_path, output_filled_pdf, data_dict)

# Optional: Flatten PDF so that fields are no longer editable
fillpdfs.flatten_pdf(output_filled_pdf, "W8BEN-E_filled_flattened.pdf")

print(f"Filled PDF saved as {output_filled_pdf}")
print(f"Flattened PDF saved as W8BEN-E_filled_flattened.pdf")
